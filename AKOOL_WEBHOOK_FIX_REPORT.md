# üîß –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ Akool webhook

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–∏—Å–∞ Akool –Ω–∞–±–ª—é–¥–∞–ª–∏—Å—å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –æ—à–∏–±–∫–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ AES:

```
ERROR [AkoolWebhookController] ‚ùå –û—à–∏–±–∫–∞ AES —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏:
Error: error:1C800064:Provider routines::bad decrypt
```

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ò–∑—É—á–µ–Ω–∏–µ –ª–æ–≥–æ–≤
- –ü–æ–¥–ø–∏—Å—å webhook –ø—Ä–æ–≤–µ—Ä—è–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ ‚úÖ
- –û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –ø—Ä–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö ‚ùå
- –ö–ª—é—á–∏: `AKOOL_CLIENT_ID` (24 —Å–∏–º–≤–æ–ª–∞), `AKOOL_CLIENT_SECRET` (32 —Å–∏–º–≤–æ–ª–∞)

### 2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
–ò–∑—É—á–µ–Ω–∞ [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Akool](https://docs.akool.com/ai-tools-suite/webhook):
- –ê–ª–≥–æ—Ä–∏—Ç–º: AES-192-CBC —Å PKCS#7 padding
- –ö–ª—é—á: clientSecret (UTF-8)
- IV: clientId (UTF-8)
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `crypto-js` –±–∏–±–ª–∏–æ—Ç–µ–∫—É

### 3. –í—ã—è–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤–æ–π –ø—Ä–∏—á–∏–Ω—ã
**–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ `crypto` –º–æ–¥—É–ª—è Node.js –≤–º–µ—Å—Ç–æ `crypto-js`

**–ü—Ä–∏—á–∏–Ω–∞**: 
- –ù–∞—Ç–∏–≤–Ω—ã–π `crypto` –º–æ–¥—É–ª—å Node.js –∏–º–µ–µ—Ç –¥—Ä—É–≥—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é AES
- `crypto-js` –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –ø—Ä–∏–º–µ—Ä–æ–º Akool
- –†–∞–∑–ª–∏—á–∏—è –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–ª—é—á–µ–π –∏ IV

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
npm install crypto-js
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏

**–ë—ã–ª–æ** (–Ω–∞—Ç–∏–≤–Ω—ã–π crypto):
```typescript
const crypto = require('crypto');
const decipher = crypto.createDecipheriv('aes-192-cbc', key, iv);
```

**–°—Ç–∞–ª–æ** (crypto-js):
```typescript
const CryptoJS = require('crypto-js');
const decrypted = CryptoJS.AES.decrypt(dataEncrypt, key, {
  iv: iv,
  mode: CryptoJS.mode.CBC,
  padding: CryptoJS.pad.Pkcs7
});
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥

```typescript
private decryptAES(dataEncrypt: string, clientId: string, clientSecret: string): string {
  try {
    const CryptoJS = require('crypto-js');

    // –ü–æ–ª—É—á–∞–µ–º –∫–ª—é—á–∏ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
    const actualClientId = this.configService.get<string>('AKOOL_CLIENT_ID');
    const actualClientSecret = this.configService.get<string>('AKOOL_CLIENT_SECRET');

    // –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –∏ IV —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    const aesKey = actualClientSecret;
    const key = CryptoJS.enc.Utf8.parse(aesKey);
    const iv = CryptoJS.enc.Utf8.parse(actualClientId);

    // –†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ–º AES-192-CBC —Å PKCS#7 padding –∏—Å–ø–æ–ª—å–∑—É—è crypto-js
    const decrypted = CryptoJS.AES.decrypt(dataEncrypt, key, {
      iv: iv,
      mode: CryptoJS.mode.CBC,
      padding: CryptoJS.pad.Pkcs7
    });

    const result = decrypted.toString(CryptoJS.enc.Utf8);
    return result;
  } catch (error) {
    this.logger.error('‚ùå –û—à–∏–±–∫–∞ AES —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏:', error);
    throw error;
  }
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ª–æ–≥–æ–≤
```json
{
  "signature": "9a0403251957a130fad76ea64236e02c3c521e70",
  "dataEncrypt": "dOiIGl2CZPmj6UKlO9yzmWPW4Tb+T93rLqKQj6ES7xP7k4H5OhvVugbymXZ0kGW8v+Bfa0oJKI0RlPkC7P7ow8MGfv8ow1idyPVOpDA0ncWuZmgMLazug/Vm1yEHrDhdr77Sz4hk9O0Oezc5VHKB6/Me5xwehJZjyVSCKTe/+2lqV7ezzDhi6LmMy7sCkVwt4rOFvq8Yafi64CnCcZLzpA==",
  "timestamp": 1757785623798,
  "nonce": "9047"
}
```

### 2. –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚úÖ **–ü–æ–¥–ø–∏—Å—å –≤–∞–ª–∏–¥–Ω–∞**
‚úÖ **–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —É—Å–ø–µ—à–Ω–∞**
‚úÖ **JSON –ø–∞—Ä—Å–∏–Ω–≥ —É—Å–ø–µ—à–µ–Ω**

### 3. –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```json
{
  "_id": "68c5ac7ff0eec691e90065c8",
  "status": 3,
  "type": "talking photo",
  "url": "https://d2qf6ukcym4kn9.cloudfront.net/1757785499654-8067.mp4",
  "deduction_credit": 30
}
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚ùå –û—à–∏–±–∫–∞ `ERR_OSSL_BAD_DECRYPT`
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ webhook –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –æ —Å—Ç–∞—Ç—É—Å–µ –≤–∏–¥–µ–æ

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ webhook –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤–∏–¥–µ–æ
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ URL –≥–æ—Ç–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Akool

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–ó–∞–º–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**: `crypto` ‚Üí `crypto-js`
2. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º—É –ø—Ä–∏–º–µ—Ä—É Akool
3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–æ–≤—ã—Ö –æ—à–∏–±–æ–∫
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–≥—É–ª—è—Ä–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ webhook –¥–∞–Ω–Ω—ã–º–∏
3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å —É—á–µ—Ç–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –°–ª–µ–¥–∏—Ç—å –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ `crypto-js`

## üîó –°—Å—ã–ª–∫–∏

- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Akool webhook](https://docs.akool.com/ai-tools-suite/webhook)
- [crypto-js –±–∏–±–ª–∏–æ—Ç–µ–∫–∞](https://github.com/brix/crypto-js)
- [GitHub Akool](https://github.com/AKOOL-Official)

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 13 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ—à–µ–Ω–æ  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ
