# üöÄ –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram –±–æ—Ç–æ–≤ –Ω–∞ NestJS

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –ß–∏—Ç–∞—Ç—å –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã!

### **–ü—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é –º—ã —Ä–µ—à–∏–ª–∏:**
- ‚ùå 404 –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ webhook
- ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤ (EADDRINUSE)
- ‚ùå Rate Limiting (429 Too Many Requests)
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ webhook

---

## üéØ –ü–†–ê–í–ò–õ–û #1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º

### **–ù–ï –ù–ê–ß–ò–ù–ê–ô–¢–ï –ö–û–î–ò–¢–¨ –°–†–ê–ó–£!**

**–ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π:**
1. üìñ **–ü—Ä–æ—á–∏—Ç–∞—Ç—å –ª–æ–≥–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é** - –ø–æ–Ω—è—Ç—å —Å—É—Ç—å –æ—à–∏–±–∫–∏
2. üìö **–ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
3. üèóÔ∏è **–ü–æ–Ω—è—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** —Ä–µ—à–µ–Ω–∏—è
4. üìã **–°–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥** —Ü–µ–ª–∏–∫–æ–º
5. ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å** –∑–∞ –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥

**–ü—Ä–∏–º–µ—Ä –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ –æ–¥–Ω–æ–π –æ—à–∏–±–∫–µ
// –û—à–∏–±–∫–∞ 1: —Å–æ–∑–¥–∞–µ–º webhook –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
// –û—à–∏–±–∫–∞ 2: –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –ø–æ—Ä—Ç—ã
// –û—à–∏–±–∫–∞ 3: –¥–æ–±–∞–≤–ª—è–µ–º retry –ª–æ–≥–∏–∫—É
// –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
```

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
// 1. –ò–∑—É—á–∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é nestjs-telegraf
// 2. –ü–æ–Ω—è–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É webhook
// 3. –°–æ–∑–¥–∞–ª–∏ –ø–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å—Ä–∞–∑—É
// –†–µ–∑—É–ª—å—Ç–∞—Ç: –±—ã—Å—Ç—Ä–æ –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ
```

---

## üèóÔ∏è –ü–†–ê–í–ò–õ–û #2: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Telegram –±–æ—Ç–æ–≤

### **Webhook vs Polling - –ø–æ–Ω–∏–º–∞—Ç—å —Ä–∞–∑–Ω–∏—Ü—É!**

```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ webhook
@Module({
  imports: [
    TelegrafModule.forRoot({
      token: process.env.BOT_TOKEN,
      middlewares: [session()],
      launchOptions: {
        webhook: {
          domain: process.env.WEBHOOK_URL,
          hookPath: '/webhook'
          // –ù–ï —É–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ—Ä—Ç - –±—É–¥–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç!
        }
      }
    })
  ]
})
export class AppModule {}
```

### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- [ ] **WebhookController** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ `/webhook` –º–∞—Ä—à—Ä—É—Ç–∞
- [ ] **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** TelegrafModule
- [ ] **Middleware –¥–ª—è JSON** - `app.use(json())`
- [ ] **Retry –ª–æ–≥–∏–∫–∞** –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤

---

## üîß –ü–†–ê–í–ò–õ–û #3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Telegram API

### **Rate Limiting (429) - –≤—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å retry!**

```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —É–º–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook
async setupWebhook() {
  let retryCount = 0;
  const maxRetries = 3;
  
  while (retryCount < maxRetries) {
    try {
      await bot.telegram.setWebhook(webhookPath);
      break;
    } catch (error: any) {
      if (error.message?.includes('429')) {
        const retryAfter = parseInt(error.message.match(/retry after (\d+)/)?.[1] || '5');
        await new Promise(resolve => setTimeout(resolve, retryAfter * 1000));
      }
      retryCount++;
    }
  }
}
```

### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] **–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å webhook** –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
- [ ] **–°–±—Ä–æ—Å —Å—Ç–∞—Ä–æ–≥–æ webhook** –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- [ ] **–ó–∞–¥–µ—Ä–∂–∫–∏** –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ (2+ —Å–µ–∫—É–Ω–¥—ã)
- [ ] **Retry –ª–æ–≥–∏–∫–∞** –¥–ª—è –≤—Å–µ—Ö API –≤—ã–∑–æ–≤–æ–≤

---

## üö´ –ü–†–ê–í–ò–õ–û #4: –ß—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å

### **–ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã:**
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - —Ö–∞—Ä–¥–∫–æ–¥ –ø–æ—Ä—Ç–æ–≤
launchOptions: {
  webhook: {
    port: 10000  // –ö–û–ù–§–õ–ò–ö–¢ —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º!
  }
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å Rate Limiting
await bot.telegram.setWebhook(webhookPath); // –ú–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å —Å 429

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ –æ–¥–Ω–æ–π –æ—à–∏–±–∫–µ
// –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä ‚Üí –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –ø–æ—Ä—Ç—ã ‚Üí –¥–æ–±–∞–≤–ª—è–µ–º retry
```

---

## üìã –ß–ï–ö-–õ–ò–°–¢ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞

### **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Telegram –±–æ—Ç–∞:**
- [ ] **–ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** `nestjs-telegraf`
- [ ] **–ü–æ–Ω—è—Ç—å —Ä–∞–∑–Ω–∏—Ü—É** webhook vs polling
- [ ] **–°—Ä–∞–∑—É –¥–æ–±–∞–≤–∏—Ç—å** retry –ª–æ–≥–∏–∫—É –¥–ª—è API
- [ ] **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å** –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] **–°–æ–∑–¥–∞—Ç—å** debug endpoints

### **–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:**
- [ ] **–ü—Ä–æ—á–∏—Ç–∞—Ç—å –ª–æ–≥–∏** –ø–æ–ª–Ω–æ—Å—Ç—å—é
- [ ] **–ü–æ–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç** –æ—à–∏–±–∫–∏
- [ ] **–ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –ø–æ –ø—Ä–æ–±–ª–µ–º–µ
- [ ] **–°–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ** —Ü–µ–ª–∏–∫–æ–º
- [ ] **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å** —Å–∏—Å—Ç–µ–º–Ω–æ

---

## üéØ –ü–†–ê–í–ò–õ–û #5: –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### **–î–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç —Å—Ä–∞–∑—É:**

```typescript
@Controller('debug')
export class DebugController {
  @Get()
  async debugInfo() {
    return {
      webhook: await this.bot.telegram.getWebhookInfo(),
      bot: await this.bot.telegram.getMe(),
      env: {
        PORT: process.env.PORT,
        WEBHOOK_URL: process.env.WEBHOOK_URL,
        NODE_ENV: process.env.NODE_ENV
      }
    };
  }
}
```

---

## üí° –ì–õ–ê–í–ù–´–ô –£–†–û–ö

**–ù–ï –°–ü–ï–®–ò–¢–ï –ò–°–ü–†–ê–í–õ–Ø–¢–¨ –û–®–ò–ë–ö–ò –ü–û –û–î–ù–û–ô!**

–õ—É—á—à–µ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ü–µ–ª–∏–∫–æ–º, —á–µ–º –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞.

**–í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ + –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ = –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [nestjs-telegraf Documentation](https://github.com/botgram/nestjs-telegraf)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Webhook vs Polling](https://core.telegram.org/bots/webhooks)
- [Rate Limiting](https://core.telegram.org/bots/faq#my-bot-is-hitting-limits-how-do-i-avoid-this)

---

*–°–æ–∑–¥–∞–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø—ã—Ç–∞ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å webhook –≤ –ø—Ä–æ–µ–∫—Ç–µ AirShorts1*
